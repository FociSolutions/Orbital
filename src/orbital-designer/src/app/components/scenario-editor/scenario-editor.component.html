<div class="fullscreen column center-hr">
  <div class="container editor">
    <div class="row">
      <div class="sidebar row">
        <app-side-bar class="row"></app-side-bar>
      </div>
      <div class="full-width" [formGroup]="scenarioForm">
        <div>
          <app-overview-header [header]="headerContent"></app-overview-header>
        </div>
        <div id="metadata-cards">
          <mat-tab-group>
            <mat-tab label="Metadata">
              <div class="tab-body">
                <app-metadata-form formControlName="metadata"></app-metadata-form>
              </div>
            </mat-tab>

            <mat-tab label="Request">
              <div class="tab-body">
                <app-add-request-match-rule
                  [requestMatchRule]="this.selectedScenario?.requestMatchRules"
                  (requestMatchRuleOutput)="handleRequestMatchRuleOutput($event)"
                  [requestMatchRuleFormGroup]="this.scenarioFormGroup.controls.requestMatchRules"
                  [tokenRule]="this.selectedScenario?.tokenRule"
                  [tokenRuleFormArray]="this.scenarioFormGroup.controls.tokenRule"
                  [saveStatus]="this.shouldSave"
                >
                </app-add-request-match-rule>
              </div>
            </mat-tab>

            <mat-tab label="Response">
              <div class="tab-body">
                <app-add-response
                  [response]="this.selectedScenario?.response"
                  (responseOutput)="handleResponseOutput($event)"
                  [responseFormGroup]="this.scenarioFormGroup.controls.response"
                  [saveStatus]="this.shouldSave"
                >
                </app-add-response>
              </div>
            </mat-tab>

            <mat-tab label="Policies">
              <div class="tab-body">
                <app-policy [policyFormArray]="this.scenarioFormGroup.controls.policies"></app-policy>
              </div>
            </mat-tab>
          </mat-tab-group>

          <div class="row button-row">
            <div id="scenario-back-button-div">
              <button id="go-to-scenarios" color="primary" mat-raised-button (click)="cancel()">
                Back to Scenarios
              </button>
            </div>
            <div id="save-button-div">
              <button id="save-button" color="primary" mat-raised-button (click)="save()">Save</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #headerContent let-path="path">
  <div class="title column center">
    <div class="endpoint-info">
      <mat-chip-list
        ><mat-chip [style.background-color]="this.endpointVerb | getVerbColor">{{
          this.endpointVerb | getVerbString
        }}</mat-chip>
      </mat-chip-list>
      <h3>
        {{ this.endpointPath }}
      </h3>
    </div>
    <div>
      <h3>
        {{ this.selectedScenario?.metadata?.title || 'New Scenario' }}
      </h3>
    </div>
  </div>
</ng-template>

<div class="overlay" *ngIf="triggerOpenCancelBox">
  <div>
    <mat-card>
      <app-dialog-box
        titleText="Confirm Scenario Changes Discard"
        confirmButtonText="Confirm"
        cancelButtonText="Cancel"
        bodyText="Are you sure you want to discard your unsaved changes?"
        (choiceBoolean)="onCancelDialogAction($event)"
      ></app-dialog-box>
    </mat-card>
  </div>
</div>
